<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org">
<head>
<title>Production Analysis - View</title>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet"
	href="https://code.highcharts.com/css/highcharts.css" />
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" />
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/drilldown.js"></script>

<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>


    <base href="https://demos.telerik.com/kendo-ui/treeview/events">
    <style>html { font-size: 14px; font-family: Arial, Helvetica, sans-serif; }</style>
  
    <link rel="stylesheet" href="https://kendo.cdn.telerik.com/2020.2.513/styles/kendo.default-v2.min.css" />

    <script src="https://kendo.cdn.telerik.com/2020.2.513/js/jquery.min.js"></script>
   
   
    <script src="https://kendo.cdn.telerik.com/2020.2.513/js/kendo.all.min.js"></script>
   
   

    <link rel="stylesheet" href="../content/shared/styles/examples-offline.css">
    <script src="../content/shared/js/console.js"></script>

  
   
   

    
    

<script th:inline="javascript">
     /*<![CDATA[*/
    	 
    	 function loadTree(){
    	 
    		 var text = '[{ "text": "Site1", "expanded": "true", "items": [{ "text": "WC1" },{ "text": "WC2" }] },{ "text": "Site2", "items": [{ "text": "WC3" },{ "text": "WC4" }] },{ "text": "WC5" }]';
    			var myObj = JSON.parse(text);
    	 
    		  function onSelect(e) {	
                  kendoConsole.log("Selecting: " + this.text(e.node));
              }

              function onCheck(e) {
                  kendoConsole.log("Checkbox changed :: " + this.text(e.node));
              }

              function onChange(e) {
                  kendoConsole.log("Selection changed");
              }

              function onCollapse(e) {
                  kendoConsole.log("Collapsing " + this.text(e.node));
              }

              function onExpand(e) {
                  kendoConsole.log("Expanding " + this.text(e.node));
              }

              function onDragStart(e) {
                  kendoConsole.log("Started dragging " + this.text(e.sourceNode));
              }

              function onDrag(e) {
                  kendoConsole.log("Dragging " + this.text(e.sourceNode));
              }

              function onDrop(e) {
                  kendoConsole.log(
                  "Dropped " + this.text(e.sourceNode) +
                  " (" + (e.valid ? "valid" : "invalid") + ")"
                  );
              }

              function onDragEnd(e) {
                  kendoConsole.log("Finished dragging " + this.text(e.sourceNode));
              }

              function onNavigate(e) {
                  if (e.node) {
                      kendoConsole.log("Navigate " + this.text(e.node));
                  }
              }

              $("#treeview").kendoTreeView({
                  checkboxes: true,
                  dataSource: myObj,
                  select: onSelect,
                  check: onCheck,
                  change: onChange,
                  collapse: onCollapse,
                  expand: onExpand,
                  dragAndDrop: true,
                  /* drag & drop events */
                  dragstart: onDragStart,
                  drag: onDrag,
                  drop: onDrop,
                  dragend: onDragEnd,
                  navigate: onNavigate
              });
     }
    	 
    	 function loadWC() {

		//alert("Inside loadWC");

		//load site1 wc
		var text = '[{"name": "WC1","y": 61.41}, {"name": "WC2","y": 11.84},{"name": "WC3","y": 14}]';
		var myObj = JSON.parse(text);

		Highcharts
				.chart(
						'containerwc1',
						{
							chart : {
								plotBackgroundColor : null,
								plotBorderWidth : null,
								plotShadow : false,
								type : 'pie'
							},
							title : {
								text : 'Performance analysis for EXID'
							},
							tooltip : {
								pointFormat : '{series.name}: <b>{point.percentage:.1f}%</b>'
							},
							accessibility : {
								point : {
									valueSuffix : '%'
								}
							},
							plotOptions : {
								pie : {
									allowPointSelect : true,
									cursor : 'pointer',
									dataLabels : {
										enabled : true,
										format : '<b>{point.name}</b>: {point.percentage:.1f} %'
									}
								},
								series : {
									cursor : 'pointer',
									point : {
										events : {
											click : function() {
												//location.href = this.options.url;
												//alert(this.name);
												loadRes(this.name);
											}
										}
									}
								}
							},
							series : [ {
								name : 'Rate',
								colorByPoint : true,
								data : myObj
							} ]
						});

		//load site2 wc
		var text = '[{"name": "WC4","y": 71.41}, {"name": "WC5","y": 29}]';
		var myObj = JSON.parse(text);

		Highcharts
				.chart(
						'containerwc2',
						{
							chart : {
								plotBackgroundColor : null,
								plotBorderWidth : null,
								plotShadow : false,
								type : 'pie'
							},
							title : {
								text : 'Performance analysis for PPME'
							},
							tooltip : {
								pointFormat : '{series.name}: <b>{point.percentage:.1f}%</b>'
							},
							accessibility : {
								point : {
									valueSuffix : '%'
								}
							},
							plotOptions : {
								pie : {
									allowPointSelect : true,
									cursor : 'pointer',
									dataLabels : {
										enabled : true,
										format : '<b>{point.name}</b>: {point.percentage:.1f} %'
									}
								},
								series : {
									cursor : 'pointer',
									point : {
										events : {
											click : function() {
												//location.href = this.options.url;
												//alert(this.name);
												loadRes(this.name);
											}
										}
									}
								}
							},
							series : [ {
								name : 'Rate',
								colorByPoint : true,
								data : myObj
							} ]
						});
	}

$(function () {
     var chart;
     $(document).ready(function() {
    	 
    	 loadTree();
    	 
     var chart;
        
    var myObj, text;
    
    var str = 'PPME-WC1,PPME-WC2,EXID-WC1';
    var search = {}
                 search["sitelist"] = str;
     $.ajax({
                     type: "POST",
                     contentType: "application/json",
                     url: "/api/searchRes/"+str,
                     data: JSON.stringify(search),
                     dataType: 'json',
                     success: function (data) {
                         text = JSON.stringify(data, null, 4);
                    
                    
                   // var text1 = '[{"y": 50,"color": "red","drilldown": {"categories": ["cat1","cat2","cat3","cat4"], "series": [{"type": "column","name": "Target","data": [10.85, 7.35, 33.06, 2.81], "color": "blue"},{"type": "column","name": "Actual","data": [1, 5, 10, 15], "color": "green"}]}}]';
     
     var myObj = JSON.parse(text);
    
    
         var colors = Highcharts.getOptions().colors,
             //categories = ['PPME','EXID'],
             categories = myObj.sites,
             //name = ['Plants',''],
             data = myObj.qty;
    
         function setChart(name, categories, data, color, type) {
             var len = chart.series.length;
             chart.xAxis[0].setCategories(categories);
             for(var i = 0; i < len; i++){
                 console.log(chart.series.length);
                 chart.series[0].remove();
             }
             console.log('a');
             if(data.series){
                 for(var i = 0; i < data.series.length; i ++ ){
                     chart.addSeries({
                         name: data.series[i].name,
                         data: data.series[i].data,
                         type: data.series[i].type,
                         color: data.series[i].color || 'white'
                     });
                 }
             } else {
                     chart.addSeries({
                    	 name: 'Sites',
                         data: data,
                         type: type,
                         color: color || 'white'
                     });
             }
         }
    
         chart = new Highcharts.Chart({
             chart: {
                 renderTo: 'container',
                 type: 'column'
             },
             title: {
                 text: 'Production Performance'
             },
             subtitle: {
                 text: 'Click the columns to view orders. Click again to view sites.'
             },
             xAxis: {
                 categories: categories
             },
             yAxis: {
                 title: {
                     text: 'Production Rate (%)'
                 }
             },
             plotOptions: {
                 column: {
                     cursor: 'pointer',
                     point: {
                         /*events: {
                             click: function() {
                                 var drilldown = this.drilldown;
                                 if (drilldown) { // drill down
                                     setChart(null, drilldown.categories, drilldown, drilldown.type);
                                 } else { // restore
                                     setChart(name, categories, data, 'column');
                                 }
                             }
                         }*/
                         events : {
								click : function() {
									//location.href = this.options.url;
									//alert("1");
									loadWC();
								}
							}
                     },
                     dataLabels: {
                         enabled: true
                  
                     }
                 },
                 spline: {
                     cursor: 'pointer',
                     point: {
                         events: {
                             click: function() {
                                 var drilldown = this.drilldown;
                                 if (drilldown) { // drill down
                                     setChart(null, drilldown.categories, drilldown, drilldown.type);
                                 } else { // restore
                                     setChart(name, categories, data, 'column');
                                 }
                             }
                         }
                       
                     },
                     dataLabels: {
                         enabled: false
                     }
                 }
             },
             tooltip: {
                 formatter: function() {
                     var point = this.point,
                         s = this.x +':<b>'+ this.y +'% </b><br/>';
                     if (point.drilldown) {
                         s += 'Click to view '+ point.category +' Order level';
                     } else {
                         s += 'Click to return back';
                     }
                     return s;
                 }
             },
             series: [{
                 name: 'Sites',
                 data: data,
                 color: 'white'
             }],
             exporting: {
                 enabled: true
             }
         });
                    
                    
                         }
                     
                 });
    
     
     
    
    
 });

});
        
     /*]]>*/
     </script>


</head>
<body>

	<table>
		<tr>
			<td>
			
			<div id="example" class="k-content">
            <div class="demo-section k-content">
                <div id="treeview"></div>
            </div>

            <div class="box">
                <h4>Console log</h4>
                <div class="console"></div>
            </div>
            
        </div>
			
			</td>
			<td>
			<div class="" align="center">
		<div class="" align="center" style="background-color: #ffffcc">
			<h4 style="color: blue;">Global Manufacturing Production
				Performance</h4>
		</div>

		<div id="container"
			style="min-width: 400px; height: 400px; margin: 0 auto"></div>
	</div>
			</td>
		</tr>
	</table>
	

	<table>
		<tr>
			<td>
				<figure class="highcharts-figure">
					<div id="containerwc1"></div>
				</figure>
			</td>
			<td>
				<figure class="highcharts-figure">
					<div id="containerwc2"></div>
				</figure>
			</td>
		</tr>
		<tr>
			<td>
				<figure class="highcharts-figure">
					<div id="containerres1"></div>
				</figure>
			</td>
			<td>
				<figure class="highcharts-figure">
					<div id="containerres2"></div>
				</figure>
			</td>
		</tr>
	</table>
</body>
</html>
